<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilkent MEC - Admin Panel</title>
    <link rel="stylesheet" href="./style.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-container h1 {
            color: #C73D29;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .login-container p {
            color: #666;
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form input {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #C73D29;
        }

        .login-form button {
            padding: 12px;
            background: linear-gradient(to right, #d32e11, #a31900);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-form button:hover {
            transform: translateY(-2px);
        }

        .login-form button:active {
            transform: translateY(0);
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 1rem;
            display: none;
        }

        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            min-height: 100vh;
            background: #f5f5f5;
            padding: 20px;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            background: linear-gradient(to right, #d32e11, #a31900);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-header h1 {
            font-size: 2rem;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: white;
            color: #C73D29;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 25px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #C73D29;
            color: white;
            border-color: #C73D29;
        }

        .tab-btn:hover {
            border-color: #C73D29;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Poppins', Arial, sans-serif;
            transition: border-color 0.3s;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #C73D29;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .btn-primary,
        .btn-danger,
        .btn-secondary {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: #C73D29;
            color: white;
        }

        .btn-primary:hover {
            background: #a31900;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .events-list,
        .sponsors-list {
            display: grid;
            gap: 1.5rem;
        }

        .event-card,
        .sponsor-card {
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #C73D29;
        }

        .event-card h3,
        .sponsor-card h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .event-card p,
        .sponsor-card p {
            color: #666;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .event-card .event-date {
            display: inline-block;
            background: #e9ecef;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .image-preview {
            margin-top: 1rem;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .cloudinary-widget {
            margin-top: 1rem;
        }

        .upload-preview {
            margin-top: 1rem;
            padding: 1rem;
            background: #f0f0f0;
            border-radius: 8px;
            text-align: center;
        }

        .upload-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
            }

            .admin-header h1 {
                font-size: 1.5rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn-group button {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Login Section -->
    <div class="login-container" id="loginContainer">
        <h1>üîê Admin Panel</h1>
        <p>Bilkent MEC Admin Paneline Ho≈ü Geldiniz</p>
        <form class="login-form" id="loginForm">
            <input type="password" id="passwordInput" placeholder="≈ûifreyi girin" required autocomplete="new-password">
            <button type="submit">Giri≈ü Yap</button>
            <div class="error-message" id="errorMessage">Hatalƒ± ≈üifre!</div>
        </form>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-container">
            <div class="admin-header">
                <h1>üìä Admin Paneli</h1>
                <button class="logout-btn" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
            </div>

            <div class="success-message" id="successMessage">‚úÖ Ba≈üarƒ±yla kaydedildi!</div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('events')">üìÖ Etkinlikler</button>
                <button class="tab-btn" onclick="switchTab('sponsors')">ü§ù Sponsorlar</button>
                <button class="tab-btn" onclick="switchTab('settings')">‚öôÔ∏è Ayarlar</button>
            </div>

            <!-- Events Tab -->
            <div id="events" class="tab-content active">
                <h2>Etkinlikler Y√∂netimi</h2>

                <div style="margin: 2rem 0; padding: 2rem; background: #f0f0f0; border-radius: 10px;">
                    <h3>Yeni Etkinlik Ekle</h3>
                    <form id="eventForm">
                        <div class="form-group">
                            <label>Etkinlik Ba≈ülƒ±ƒüƒ±</label>
                            <input type="text" id="eventTitle" placeholder="√∂rn: StepForward" required>
                        </div>
                        <div class="form-group">
                            <label>A√ßƒ±klama</label>
                            <textarea id="eventDescription" placeholder="Etkinlik hakkƒ±nda a√ßƒ±klama"
                                required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Tarih ve Saat</label>
                            <input type="datetime-local" id="eventDate" required>
                        </div>
                        <div class="form-group">
                            <label>Etkinlik G√∂rseli</label>
                            <input type="file" id="eventImage" accept="image/*">
                            <div class="image-preview" id="eventImagePreview"></div>
                        </div>
                        <div class="form-group">
                            <label>ƒ∞nstagram Linki (Detaylar i√ßin)</label>
                            <input type="url" id="eventLink" placeholder="https://instagram.com/bilkentmec">
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn-primary">Etkinlik Ekle</button>
                        </div>
                    </form>
                </div>

                <h3 style="margin-top: 2rem;">Mevcut Etkinlikler</h3>
                <div class="events-list" id="eventsList"></div>
            </div>

            <!-- Sponsors Tab -->
            <div id="sponsors" class="tab-content">
                <h2>Sponsorlar Y√∂netimi</h2>

                <div
                    style="margin: 2rem 0; padding: 2rem; background: #e8f4fd; border-radius: 10px; border: 1px solid #b6e0fe;">
                    <h3>Sponsor Gruplarƒ±nƒ± Y√∂net</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                        <input type="text" id="newGroupName" placeholder="Yeni Grup Adƒ± (√∂rn: Platin Sponsorlar)"
                            style="flex: 1;">
                        <button type="button" class="btn-primary" onclick="addSponsorGroup()">Grup Ekle</button>
                    </div>
                    <div id="groupList" style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <!-- Grupler buraya dinamik gelecek -->
                        <span style="color: #666;">Y√ºkleniyor...</span>
                    </div>
                </div>

                <div style="margin: 2rem 0; padding: 2rem; background: #f0f0f0; border-radius: 10px;">
                    <h3>Yeni Sponsor Ekle</h3>
                    <form id="sponsorForm">
                        <div class="form-group">
                            <label>Sponsor Adƒ±</label>
                            <input type="text" id="sponsorName" placeholder="√∂rn: Samsung" required>
                        </div>
                        <div class="form-group">
                            <label>Sponsor Grubu</label>
                            <select id="sponsorGroup" required>
                                <option value="">Y√ºkleniyor...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Logo G√∂rseli</label>
                            <input type="file" id="sponsorImage" accept="image/*" required>
                            <div class="image-preview" id="sponsorImagePreview"></div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn-primary">Sponsor Ekle</button>
                        </div>
                    </form>
                </div>

                <h3 style="margin-top: 2rem;">Mevcut Sponsorlar</h3>
                <div class="sponsors-list" id="sponsorsList"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>Site Ayarlarƒ±</h2>
                <div style="padding: 2rem; background: #f0f0f0; border-radius: 10px;">
                    <div class="form-group">
                        <label>Site Ba≈ülƒ±ƒüƒ±</label>
                        <input type="text" id="siteTitle" placeholder="Bilkent MEC">
                    </div>
                    <div class="form-group">
                        <label>Motto</label>
                        <input type="text" id="siteMotto" placeholder="Yaratƒ±cƒ± ruh, profesyonel i≈ü.">
                    </div>
                    <div class="form-group">
                        <label>Ana A√ßƒ±klama</label>
                        <textarea id="siteDescription" placeholder="Hakkƒ±mƒ±z hakkƒ±nda a√ßƒ±klama"></textarea>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn-primary" onclick="saveSettings()">Ayarlarƒ± Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cloudinary Widget -->
    <script src="https://upload-widget.cloudinary.com/latest/sources/index.js"></script>

    <!-- Firebase SDK (v8 CDN - exposes global `firebase` for legacy code) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBl2kj0jv7ygo4o6XR03nOf4Pr1rWpKMO8",
            authDomain: "bilkentmec-b2e41.firebaseapp.com",
            projectId: "bilkentmec-b2e41",
            storageBucket: "bilkentmec-b2e41.firebasestorage.app",
            messagingSenderId: "487196460894",
            appId: "1:487196460894:web:afac01f54c496fc4de71cf",
            measurementId: "G-JZW2WY854K"
        };

        // Firebase Initialize
        firebase.initializeApp(firebaseConfig);
        window.db = firebase.firestore(); // Make db global

        console.log('Firebase initialized!', window.db);

        // Cloudinary Config
        const cloudinaryConfig = {
            cloudName: 'dud2jiqap',
            uploadPreset: 'bilkentmec'
        };

        const ADMIN_PASSWORD = 'mec2025';
        let isLoggedIn = false;

        // Sayfanƒ±n en ba≈üƒ±nda localStorage'ƒ± kontrol et ve temizle
        window.addEventListener('load', function () {
            console.log('Admin panel y√ºkleniyor...');
            console.log('localStorage adminLoggedIn:', localStorage.getItem('adminLoggedIn'));
            // ƒ∞lk ziyarette localStorage'ƒ± temizle
            if (!localStorage.getItem('adminPanelInitialized')) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.setItem('adminPanelInitialized', 'true');
                console.log('localStorage temizlendi');
            }
        });

        // Login Handler
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const passwordInput = document.getElementById('passwordInput');
            const password = passwordInput.value;


            if (password === ADMIN_PASSWORD) {
                console.log('‚úÖ Login ba≈üarƒ±lƒ±!');
                isLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                loadData();
            } else {
                console.log('‚ùå Login ba≈üarƒ±sƒ±z!');
                document.getElementById('errorMessage').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 3000);
                passwordInput.value = '';
            }
        });

        // Check if already logged in
        window.addEventListener('load', function () {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                isLoggedIn = true;
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                loadData();
            }
        });

        // Logout
        function logout() {
            isLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('passwordInput').value = '';
            document.getElementById('eventForm').reset();
            document.getElementById('sponsorForm').reset();
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Cloudinary Upload Handler
        function uploadToCloudinary(inputId, previewId) {
            const input = document.getElementById(inputId);

            input.addEventListener('change', async function (e) {
                const file = e.target.files[0];
                if (!file) return;

                // Loading g√∂stergesi
                const preview = document.getElementById(previewId);
                preview.innerHTML = '<p>‚è≥ Y√ºkleniyor...</p>';

                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', cloudinaryConfig.uploadPreset);

                try {
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/image/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Upload ba≈üarƒ±sƒ±z');
                    }

                    const data = await response.json();
                    console.log('Upload ba≈üarƒ±lƒ±:', data.secure_url);

                    // Hidden input ile URL'i saklayalƒ±m
                    const existingInput = preview.querySelector('.imageUrl');
                    if (existingInput) {
                        existingInput.remove();
                    }

                    preview.innerHTML = `
                        <img src="${data.secure_url}" alt="preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                        <input type="hidden" class="imageUrl" value="${data.secure_url}">
                        <p style="color: green; margin-top: 10px;">‚úÖ Resim y√ºklendi!</p>
                    `;
                } catch (err) {
                    console.error('Upload hatasƒ±:', err);
                    preview.innerHTML = '<p style="color: red;">‚ùå Resim y√ºkleme ba≈üarƒ±sƒ±z!</p>';
                }
            });
        }

        uploadToCloudinary('eventImage', 'eventImagePreview');
        uploadToCloudinary('sponsorImage', 'sponsorImagePreview');

        // SPONSOR GRUP Y√ñNETƒ∞Mƒ∞
        const SETTINGS_DOC_ID = 'site_metadata'; // Tek bir d√∂k√ºman altƒ±nda tutacaƒüƒ±z

        async function loadSponsorGroups() {
            const groupSelect = document.getElementById('sponsorGroup');
            const groupList = document.getElementById('groupList');

            if (!groupSelect || !groupList) return;

            try {
                const doc = await window.db.collection('settings').doc(SETTINGS_DOC_ID).get();
                let groups = [];

                if (doc.exists && doc.data().sponsorGroups) {
                    groups = doc.data().sponsorGroups;
                } else {
                    // ƒ∞lk kez √ßalƒ±≈üƒ±yorsa varsayƒ±lanlarƒ± ekle
                    groups = ['Investment Weekend', 'StepForward'];
                    await window.db.collection('settings').doc(SETTINGS_DOC_ID).set({ sponsorGroups: groups }, { merge: true });
                }

                // Dropdown'u doldur
                groupSelect.innerHTML = '<option value="">Se√ß...</option>' +
                    groups.map(g => `<option value="${g}">${g}</option>`).join('');

                // Y√∂netim listesini doldur
                groupList.innerHTML = groups.map(g => `
                    <div style="background: white; padding: 5px 10px; border-radius: 5px; border: 1px solid #ccc; display: flex; align-items: center; gap: 5px;">
                        <span>${g}</span>
                        <button onclick="renameSponsorGroup('${g}')" style="background: none; border: none; color: blue; cursor: pointer; font-weight: bold;" title="Yeniden Adlandƒ±r">‚úé</button>
                        <button onclick="deleteSponsorGroup('${g}')" style="background: none; border: none; color: red; cursor: pointer; font-weight: bold;" title="Sil">‚úï</button>
                    </div>
                `).join('');

            } catch (error) {
                console.error("Grup y√ºkleme hatasƒ±:", error);
                groupList.innerHTML = '<span style="color:red">Hata olu≈ütu</span>';
            }
        }

        async function addSponsorGroup() {
            const input = document.getElementById('newGroupName');
            const newGroup = input.value.trim();

            if (!newGroup) return alert("L√ºtfen bir grup adƒ± yazƒ±n.");

            try {
                await window.db.collection('settings').doc(SETTINGS_DOC_ID).set({
                    sponsorGroups: firebase.firestore.FieldValue.arrayUnion(newGroup)
                }, { merge: true });
                input.value = ''; // Temizle
                loadSponsorGroups(); // Listeyi yenile
                alert("Grup eklendi!");
            } catch (error) {
                console.error("Grup ekleme hatasƒ±:", error);

                alert("Hata olu≈ütu: " + error.message);
            }
        }

        window.deleteSponsorGroup = async function (groupName) {
            if (!confirm(`"${groupName}" grubunu silmek istediƒüine emin misin?`)) return;

            try {
                await window.db.collection('settings').doc(SETTINGS_DOC_ID).update({
                    sponsorGroups: firebase.firestore.FieldValue.arrayRemove(groupName)
                });
                loadSponsorGroups(); // Listeyi yenile
            } catch (error) {
                console.error("Grup silme hatasƒ±:", error);
                alert("Silinirken hata olu≈ütu.");
            }
        };


        // Login ba≈üarƒ±lƒ± olduƒüunda veya sayfa y√ºklendiƒüinde verileri √ßek
        function loadData() {
            loadEvents();
            loadSponsors();
            loadSponsorGroups(); // Gruplarƒ± da y√ºkle

            // Site ayarlarƒ±nƒ± da y√ºkle (mevcut kodun devamƒ± olabilir)
            const siteTitle = document.getElementById('siteTitle');
            if (siteTitle) {
                const savedTitle = localStorage.getItem('siteTitle');
                if (savedTitle) siteTitle.value = savedTitle;
            }
        }





        async function addSponsorGroup() {
            const input = document.getElementById('newGroupName');
            const newGroup = input.value.trim();

            if (!newGroup) return alert("L√ºtfen bir grup adƒ± yazƒ±n.");

            try {
                await window.db.collection('settings').doc(SETTINGS_DOC_ID).set({
                    sponsorGroups: firebase.firestore.FieldValue.arrayUnion(newGroup)
                }, { merge: true });
                input.value = ''; // Temizle
                loadSponsorGroups(); // Listeyi yenile
                alert("Grup eklendi!");
            } catch (error) {
                console.error("Grup ekleme hatasƒ±:", error);
                // Eƒüer d√∂k√ºman yoksa update hata verebilir, set ile deneyelim (fakat loadSponsorGroups zaten olu≈üturmalƒ±)
                alert("Hata olu≈ütu: " + error.message);
            }
        }

        async function renameSponsorGroup(oldName) {
            const newName = prompt(`"${oldName}" grubunun yeni adƒ±nƒ± girin:`, oldName);
            if (!newName || newName === oldName) return;

            try {
                // 1. Ayarlarƒ± g√ºncelle (eskiyi sil, yeniyi ekle - aslƒ±nda dizide replace yapmak daha iyi)
                const settingsRef = window.db.collection('settings').doc(SETTINGS_DOC_ID);
                const doc = await settingsRef.get();
                if (!doc.exists) return;

                let groups = doc.data().sponsorGroups || [];
                const index = groups.indexOf(oldName);
                if (index !== -1) {
                    groups[index] = newName; // Yerinde g√ºncelle (sƒ±ralamayƒ± koru)
                    await settingsRef.update({ sponsorGroups: groups });
                }

                // 2. Bu gruba ait sponsorlarƒ± g√ºncelle
                const sponsorsRef = window.db.collection('sponsors');
                const snapshot = await sponsorsRef.where('group', '==', oldName).get();

                // Batch update (max 500 operations)
                const batch = window.db.batch();
                snapshot.forEach(doc => {
                    batch.update(doc.ref, { group: newName });
                });
                await batch.commit();

                alert("Grup ismi ve ilgili sponsorlar g√ºncellendi!");
                loadSponsorGroups();
                loadSponsors(); // Listeyi yenile
            } catch (error) {
                console.error("Grup g√ºncelleme hatasƒ±:", error);
                alert("Hata: " + error.message);
            }
        }
        window.renameSponsorGroup = renameSponsorGroup;

        window.deleteSponsorGroup = async function (groupName) {
            if (!confirm(`"${groupName}" grubunu silmek istediƒüine emin misin?`)) return;

            try {
                await window.db.collection('settings').doc(SETTINGS_DOC_ID).update({
                    sponsorGroups: firebase.firestore.FieldValue.arrayRemove(groupName)
                });
                loadSponsorGroups(); // Listeyi yenile
            } catch (error) {
                console.error("Grup silme hatasƒ±:", error);
                alert("Silinirken hata olu≈ütu.");
            }
        };


        // Login ba≈üarƒ±lƒ± olduƒüunda veya sayfa y√ºklendiƒüinde verileri √ßek
        function loadData() {
            loadEvents();
            loadSponsors();
            loadSponsorGroups(); // Gruplarƒ± da y√ºkle

            // Site ayarlarƒ±nƒ± da y√ºkle (mevcut kodun devamƒ± olabilir)
            const siteTitle = document.getElementById('siteTitle');
            if (siteTitle) {
                const savedTitle = localStorage.getItem('siteTitle');
                if (savedTitle) siteTitle.value = savedTitle;
            }
        }
        document.getElementById('eventForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const imageUrlInput = document.querySelector('#eventImagePreview .imageUrl');
            const imageUrl = imageUrlInput ? imageUrlInput.value : '';

            const eventData = {
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                date: document.getElementById('eventDate').value,
                image: imageUrl,
                link: document.getElementById('eventLink').value,
                createdAt: new Date()
            };

            try {
                // Firebase'e kaydet
                await db.collection('events').add(eventData);
                console.log('Firebase\'ye kaydedildi:', eventData);

                showSuccess();
                document.getElementById('eventForm').reset();
                document.getElementById('eventImagePreview').innerHTML = '';
                loadEvents();
            } catch (err) {
                console.error('Firebase kayƒ±t hatasƒ±:', err);
                alert('Etkinlik kaydƒ± ba≈üarƒ±sƒ±z: ' + err.message);
            }
        });

        // Add Sponsor
        document.getElementById('sponsorForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const imageUrlInput = document.querySelector('#sponsorImagePreview .imageUrl');
            const imageUrl = imageUrlInput ? imageUrlInput.value : '';

            if (!imageUrl) {
                alert('L√ºtfen sponsor logosunu y√ºkleyin!');
                return;
            }

            const sponsorData = {
                name: document.getElementById('sponsorName').value,
                group: document.getElementById('sponsorGroup').value,
                image: imageUrl,
                createdAt: new Date()
            };

            try {
                // Firebase'e kaydet
                await db.collection('sponsors').add(sponsorData);
                console.log('Firebase\'ye kaydedildi:', sponsorData);

                showSuccess();
                document.getElementById('sponsorForm').reset();
                document.getElementById('sponsorImagePreview').innerHTML = '';
                loadSponsors();
            } catch (err) {
                console.error('Firebase kayƒ±t hatasƒ±:', err);
                alert('Sponsor kaydƒ± ba≈üarƒ±sƒ±z: ' + err.message);
            }
        });

        // Load Events from Firebase
        function loadEvents() {
            try {
                db.collection('events').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                    const events = [];
                    snapshot.forEach((doc) => {
                        events.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });

                    console.log('Firebase\'den etkinlikler y√ºklendi:', events.length);

                    const eventsList = document.getElementById('eventsList');

                    if (events.length === 0) {
                        eventsList.innerHTML = '<p style="color: #666;">Hen√ºz etkinlik eklenmedi.</p>';
                        return;
                    }

                    eventsList.innerHTML = events.map(event => `
                        <div class="event-card">
                            <h3>${event.title}</h3>
                            <p>${event.description}</p>
                            <div class="event-date">${new Date(event.date).toLocaleString('tr-TR')}</div>
                            ${event.image ? `<img src="${event.image}" style="max-width: 200px; border-radius: 8px; margin: 1rem 0; display: block;">` : '<p style="color: #ccc;">Resim yok</p>'}
                            <div class="btn-group">
                                <button class="btn-danger" onclick="deleteEvent('${event.id}')">Sil</button>
                            </div>
                        </div>
                    `).join('');
                });
            } catch (err) {
                console.error('loadEvents hatasƒ±:', err);
                document.getElementById('eventsList').innerHTML = '<p style="color: red;">Veri y√ºkleme hatasƒ±!</p>';
            }
        }

        // Load Sponsors from Firebase
        function loadSponsors() {
            try {
                db.collection('sponsors').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                    const sponsors = [];
                    snapshot.forEach((doc) => {
                        sponsors.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });

                    console.log('Firebase\'den sponsorlar y√ºklendi:', sponsors.length);

                    const sponsorsList = document.getElementById('sponsorsList');

                    if (sponsors.length === 0) {
                        sponsorsList.innerHTML = '<p style="color: #666;">Hen√ºz sponsor eklenmedi.</p>';
                        return;
                    }

                    sponsorsList.innerHTML = sponsors.map(sponsor => `
                        <div class="sponsor-card">
                            <h3>${sponsor.name}</h3>
                            <p>Grup: ${sponsor.group}</p>
                            ${sponsor.image ? `<img src="${sponsor.image}" style="max-width: 150px; border-radius: 8px; margin: 1rem 0; display: block;">` : '<p style="color: #ccc;">Resim yok</p>'}
                            <div class="btn-group">
                                <button class="btn-danger" onclick="deleteSponsor('${sponsor.id}')">Sil</button>
                            </div>
                        </div>
                    `).join('');
                });
            } catch (err) {
                console.error('loadSponsors hatasƒ±:', err);
                document.getElementById('sponsorsList').innerHTML = '<p style="color: red;">Veri y√ºkleme hatasƒ±!</p>';
            }
        }

        // Delete Event
        function deleteEvent(id) {
            if (confirm('Bu etkinliƒüi silmek istediƒüinizden emin misiniz?')) {
                db.collection('events').doc(id).delete()
                    .then(() => {
                        console.log('Etkinlik silindi');
                        showSuccess();
                    })
                    .catch(err => console.error('Silme hatasƒ±:', err));
            }
        }

        // Delete Sponsor
        function deleteSponsor(id) {
            if (confirm('Bu sponsoru silmek istediƒüinizden emin misiniz?')) {
                db.collection('sponsors').doc(id).delete()
                    .then(() => {
                        console.log('Sponsor silindi');
                        showSuccess();
                    })
                    .catch(err => console.error('Silme hatasƒ±:', err));
            }
        }

        // Save Settings
        function saveSettings() {
            const settings = {
                title: document.getElementById('siteTitle').value,
                motto: document.getElementById('siteMotto').value,
                description: document.getElementById('siteDescription').value
            };
            localStorage.setItem('siteSettings', JSON.stringify(settings));
            showSuccess();
        }

        // Show Success Message
        function showSuccess() {
            const msg = document.getElementById('successMessage');
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 3000);
        }

        // Load Data on Start
        function loadData() {
            loadEvents();
            loadSponsors();
        }
    </script>
</body>

</html>